# supaBase

CREATE TABLE goods (
  goodsId bigint not null unique primary key,
  goodsNme varchar(255),
  goodsPrc bigint,
  goodsTax bigint,
  goodsPlc varchar(255),
  goodsTotal float,
  goodsStrtDate timestamptz,
  goodsExpDate timestamptz
)





CREATE TABLE customers(
  cusId bigint not null unique primary key,
  cusG_id bigint,
  cusG_name varchar(255),
  cusG_quan int,
  cusG_prc bigint,
  cusG_tax bigint,
  cusG_discnt float,
  cusG_discnt_totl float,
  cusG_total bigint,
  cusPaymet varchar(255),
  cusPaid float,
  cusChanges float,
  cusCheck date
)

CREATE TABLE goods (
  goodsId bigint not null unique primary key,
  goodsQuantity int,
  goodsNme varchar(255),
  goodsPrc bigint,
  goodsTax bigint,
  goodsPlc varchar(255),
  goodsStrtDate time,
  goodsExpDate time
)



CREATE TABLE customers(
  cusId bigint not null unique primary key,
  cusVoucherNo auto increment int
  cusRegistCounterId int,
  cusG_id bigint,
  cusG_name varchar(255),
  cusG_quan int,
  cusG_prc bigint,
  cusG_tax bigint,
  cusG_discnt float,
  cusG_discnt_totl float,
  cusG_total bigint,
  cusPaymet varchar(255),
  cusPaid float,
  cusChanges float,
  cusCheck date
)



create table mainShop(
  branchShopName varchar(255) unique,
  branchShopOwner varchar(255),
  phNo varchar(255) unique,
  fax varchar(255) unique,
  startDate date
)

create table branchShop(
  staff_id int unique primary key,
  staff_name varchar(255),
  staff_counter_check_time timestamp
)

create table top(
  main varchar(255) unique primary key
)

create table mainShop(
  branchShopName varchar(255) unique,
  branchShopOwner varchar(255),
  phNo varchar(255) unique,
  fax varchar(255) unique,
  startDate date
)

Sure! Below is an example of a SQL query to create a simple table structure for a shopping mall receipt:

```sql
CREATE TABLE shopping_receipt (
    receipt_id INT PRIMARY KEY AUTO_INCREMENT,
    item_name VARCHAR(255),
    quantity INT,
    price DECIMAL(10, 2),
    total_price DECIMAL(10, 2)
);
```

This SQL query creates a table named `shopping_receipt` with the following columns:

- `receipt_id`: An integer column to uniquely identify each receipt. It's set as the primary key, and it auto-increments for each new receipt.
- `item_name`: A VARCHAR column to store the name of each item purchased.
- `quantity`: An integer column to store the quantity of each item purchased.
- `price`: A DECIMAL column to store the price per unit of each item.
- `total_price`: A DECIMAL column to store the total price for each item (quantity * price).

You can customize this table structure based on your specific requirements. For example, you might want to add columns for the date of purchase, customer information, etc., depending on the complexity of your shopping mall system.

Sure! To calculate the total price including taxes, you need to incorporate tax calculations into your SQL query. Let's assume you have a tax rate stored in your database or you can provide it directly in the query. Here's how you can modify the previous SQL query to include taxes:

```sql
CREATE TABLE shopping_receipt (
    receipt_id INT PRIMARY KEY AUTO_INCREMENT,
    item_name VARCHAR(255),
    quantity INT,
    price DECIMAL(10, 2),
    tax_rate DECIMAL(5, 2), -- New column for tax rate
    total_price_excluding_tax DECIMAL(10, 2), -- New column for total price excluding tax
    total_price_including_tax DECIMAL(10, 2) -- New column for total price including tax
);
```

In this modified table structure, I've added a new column `tax_rate` to store the tax rate for each item. I've also added two new columns: `total_price_excluding_tax` to store the total price of the items without tax, and `total_price_including_tax` to store the total price including tax.

Now, let's insert some sample data and calculate the total price including tax using a SQL query:

```sql
INSERT INTO shopping_receipt (item_name, quantity, price, tax_rate)
VALUES
    ('Item 1', 2, 10.00, 0.10), -- Assuming tax rate of 10%
    ('Item 2', 1, 20.00, 0.08), -- Assuming tax rate of 8%
    ('Item 3', 3, 15.00, 0.12); -- Assuming tax rate of 12%

UPDATE shopping_receipt
SET total_price_excluding_tax = quantity * price,
    total_price_including_tax = (quantity * price) + (quantity * price * tax_rate);

SELECT * FROM shopping_receipt;
```

In this example, we first insert sample data into the `shopping_receipt` table, including the item name, quantity, price, and tax rate. Then, we use an UPDATE statement to calculate the total price excluding tax and the total price including tax for each item using the provided tax rate. Finally, we select all columns from the `shopping_receipt` table to see the calculated results.


提出物：
　１．ER図
　２．テーブル定義書
　３．作成したSQLスクリプト（例：テーブル作成、データ挿入、クエリ）
　４．クエリの実行結果とそれに対する感想（わかったこと・難しかったところ・工夫したところ　など）
１．ER図　ー＞添付画像
２．テーブル定義書　ー＞SQL文で載せます
３．作成したSQLスクリプト ->テーブル作成はテーブル定義書と同じです
 
store
create table
  public.store (
    id_store bigint generated by default as identity,
    name text not null,
    constraint store_pkey primary key (id_store)
  ) tablespace pg_default;
 
orders
create table
  public.orders (
    id_orders bigint generated by default as identity,
    voucher_number timestamp with time zone not null default now(),
    table_number smallint null,
    constraint orders_pkey primary key (id_orders)
  ) tablespace pg_default;
 
anorder
create table
  public.anorder (
    id_anorder bigint generated by default as identity,
    id_orders bigint not null,
    id_menu bigint null,
    constraint anorder_pkey primary key (id_anorder)
  ) tablespace pg_default;
 
menu
create table
  public.menu (
    id_menu bigint generated by default as identity,
    name text not null,
    price bigint null,
    constraint menu_pkey primary key (id_menu)
  ) tablespace pg_default;
 
staff
create table
  public.staff (
    id_staff bigint generated by default as identity,
    name text not null,
    constraint staff_pkey primary key (id_staff)
  ) tablespace pg_default;
 
account
create table
  public.account (
    id_account bigint generated by default as identity,
    id_store bigint null,
    id_staff bigint not null,
    id_orders bigint null,
    amount bigint null,
    date timestamp without time zone null default now(),
    constraint account_pkey primary key (id_account)
  ) tablespace pg_default;
 
３．作成したSQLスクリプト 
４．クエリの実行結果とそれに対する感想　ー＞下にクエリと感想を書きます。
 
SELECT
  account.id_account,
  store.name as store_name,
  staff.name as staff_name,
  account.id_orders,
  order_summary.voucher_number,
  order_summary.table_number,
  total_price as amount,
  account.date
FROM
  account
LEFT JOIN
  store ON account.id_store = store.id_store
LEFT JOIN
  staff ON account.id_staff = staff.id_staff
JOIN
  (
    SELECT
      orders.id_orders,
      orders.voucher_number,
      orders.table_number,
      SUM(menu.price) AS total_price
    FROM
      orders
    JOIN
      anorder ON orders.id_orders = anorder.id_orders
    JOIN
      menu ON anorder.id_menu = menu.id_menu
    GROUP BY
      orders.id_orders
  ) AS order_summary ON order_summary.id_orders = account.id_orders;
 
工夫をしたのはこのクエリです。注文メニューの合計を求めるサブクエリを作って、それをaccount（会計）テーブルにJOINしています。まずは、領収書を発行するのに必要な最小限のデータを、上記クエリで作ってみました。
https://github.com/dianess/sql-challenge.git
